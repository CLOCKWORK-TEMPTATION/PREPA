# الدليل الشامل للمشروع

## نظرة عامة على المنتج

### الغرض من المشروع

هذا المشروع عبارة عن مجموعة اختبارات شاملة لمكتبة Docling، وهي مكتبة لمعالجة وتحويل المستندات. يركز المشروع على تقييم قدرات Docling عبر سيناريوهات مختلفة بما في ذلك المعالجة باستخدام CPU/GPU، والدعم متعدد اللغات (العربية من اليمين إلى اليسار)، وتنسيقات المستندات المختلفة.

### الميزات الرئيسية

- **اختبار تحويل المستندات**: تقييم شامل لتحويل PDF إلى Markdown/JSON
- **تحليل الأداء**: مقارنات وقت المعالجة بين CPU و GPU واختبار التحسين
- **الدعم متعدد اللغات**: اختبار متخصص لمعالجة النصوص العربية من اليمين إلى اليسار (RTL)
- **الحفاظ على التخطيط**: اختبار الاحتفاظ ببنية المستند بما في ذلك الجداول والصور والكتل النصية
- **تصدير التنسيقات**: إنشاء مخرجات متعددة التنسيقات (Markdown، JSON) مع دعم الترميز
- **معالجة الأخطاء**: آليات قوية للتعامل مع الاستثناءات والبدائل الاحتياطية

### المستخدمون المستهدفون

- **مهندسو معالجة المستندات**: اختبار والتحقق من صحة سير عمل تحويل المستندات
- **فرق البحث**: معالجة الأوراق الأكاديمية ومستندات البحث من مصادر مثل arXiv
- **فرق المحتوى متعدد اللغات**: العمل مع المستندات العربية ومستندات RTL
- **مهندسو الأداء**: تحسين خطوط أنابيب معالجة المستندات لتكوينات الأجهزة المختلفة

### حالات الاستخدام

- معالجة وتحليل الأوراق الأكاديمية من مستودعات arXiv
- تحويل المستندات متعددة اللغات مع المعالجة الصحيحة لنصوص RTL
- قياس الأداء لأنظمة معالجة المستندات
- استخراج والحفاظ على بنية المستند مع مراعاة التخطيط
- معالجة دفعات من المستندات مع تقارير شاملة للأخطاء

---

## بنية المشروع

### تنظيم الدليل

```
e:\PREPA/
├── .amazonq/rules/memory-bank/     # الوثائق والقواعد
├── docling_comprehensive_test.py   # مجموعة اختبار الميزات الكاملة
├── docling_cpu_final.py           # المعالجة المحسّنة لـ CPU
├── docling_simple_test.py         # اختبارات الوظائف الأساسية
├── docling_arabic_rtl_test.py     # دعم اللغة العربية RTL
├── docling_basic_example.py       # أمثلة المستوى الأساسي
├── docling_final_demo.py          # العرض التوضيحي الكامل
├── docling_gpu_test.py            # اختبار تسريع GPU
├── docling_simple_cpu.py          # معالجة CPU المبسطة
├── arabic_output.md               # نتائج معالجة العربية
└── docling_final_output.md        # مخرجات العرض النهائي
```

### المكونات الأساسية

#### وحدات الاختبار

- **الاختبار الشامل** (`docling_comprehensive_test.py`): معالجة المستندات كاملة الميزات مع تحليل التخطيط
- **اختبار الأداء** (`docling_cpu_final.py`, `docling_gpu_test.py`): اختبار التحسين الخاص بالأجهزة
- **اختبار اللغة** (`docling_arabic_rtl_test.py`): معالجة النصوص متعددة اللغات و RTL
- **الأمثلة الأساسية** (`docling_basic_example.py`, `docling_simple_test.py`): عروض توضيحية للوظائف الأساسية

#### ملفات المخرجات

- **تصديرات Markdown**: نتائج تحويل المستندات بتنسيق Markdown
- **تصديرات JSON**: بيانات المستند المنظمة بتنسيق JSON
- **مخرجات خاصة باللغة**: نتائج معالجة العربية و RTL

### الأنماط المعمارية

#### خط أنابيب معالجة المستندات

1. **تهيئة المحول**: إعداد DocumentConverter مع خيارات خاصة بالتنسيق
2. **معالجة المصدر**: استرجاع المستندات المستندة إلى URL (بشكل أساسي أوراق arXiv)
3. **تنفيذ التحويل**: معالجة المستند مع معالجة الأخطاء
4. **التصدير متعدد التنسيقات**: إنشاء مخرجات Markdown و JSON في وقت واحد
5. **التحليل والتقارير**: تحليل بنية المستند ومقاييس الأداء

#### إدارة التكوين

- **خيارات خط الأنابيب**: PdfPipelineOptions لتكوين OCR والمعالجة
- **خيارات التنسيق**: إعدادات خاصة بالمحول لأنواع المستندات المختلفة
- **تحسين الأجهزة**: اختيار وضع معالجة CPU/GPU

#### استراتيجية معالجة الأخطاء

- كتل try-catch شاملة حول عمليات التحويل
- التدهور التدريجي لمشاكل توافق الأجهزة
- تقارير مفصلة للأخطاء مع معلومات السياق

---

## المجموعة التقنية

### لغة البرمجة

- **Python**: لغة التطوير الأساسية لجميع وحدات الاختبار والبرامج النصية للمعالجة

### التبعيات الأساسية

#### معالجة المستندات

- **docling**: مكتبة تحويل المستندات الرئيسية
  - `DocumentConverter`: وظيفة التحويل الأساسية
  - `PdfPipelineOptions`: تكوين معالجة PDF
  - `InputFormat`: معالجة تنسيق المستند
  - `base_models`: تعريفات نموذج البيانات

#### المكتبات القياسية

- **json**: معالجة وتصدير بيانات JSON
- **time**: قياس الأداء والتوقيت
- **encoding**: معالجة نصوص UTF-8 للدعم متعدد اللغات

### بيئة التطوير

#### عمليات الملفات

- **ترميز UTF-8**: الترميز القياسي لجميع عمليات ملفات النصوص
- **مسارات متعددة المنصات**: معالجة مسارات Windows مع فواصل مناسبة
- **إدخال/إخراج الملفات**: قراءة/كتابة ملفات النصوص مع تحديد الترميز المناسب

#### أوضاع المعالجة

- **معالجة CPU**: وضع احتياطي للأنظمة بدون تسريع GPU
- **معالجة GPU**: معالجة المستندات المسرّعة بالأجهزة (عند التوفر)
- **تكامل OCR**: التعرف الضوئي على الحروف للمستندات الممسوحة ضوئياً

### الموارد الخارجية

- **مستودع arXiv**: المصدر الأساسي لمستندات الاختبار
  - الأوراق الأكاديمية بتنسيق PDF
  - بنية مستند موحدة للاختبار
  - وصول موثوق مستند إلى URL للاختبار الآلي

### تنسيقات المخرجات

- **Markdown**: الحفاظ على بنية المستند القابلة للقراءة البشرية
- **JSON**: تصدير البيانات المنظمة القابلة للقراءة الآلية
- **ملفات نصية UTF-8**: دعم المحتوى متعدد اللغات بما في ذلك العربية RTL

### اعتبارات الأداء

- **اكتشاف الأجهزة**: اختيار تلقائي لوضع CPU/GPU
- **إدارة الذاكرة**: معالجة فعالة للمستندات الكبيرة
- **استرداد الأخطاء**: معالجة سلسة لفشل المعالجة
- **مقاييس التوقيت**: قياس الأداء والتقارير

---

## إرشادات التطوير

### معايير جودة الكود

#### بنية الملفات والتسمية

- **أسماء ملفات وصفية**: استخدم أسماء واضحة موجهة نحو الغرض (مثل `docling_comprehensive_test.py`، `docling_arabic_rtl_test.py`)
- **تعليقات الرأس**: يبدأ كل ملف بتعليق وصفي يشرح غرضه
- **تسمية الدوال**: استخدم أسماء دوال وصفية تشير بوضوح إلى الوظيفة (`comprehensive_layout_test()`، `test_arabic_rtl()`)

#### تنظيم الاستيراد

- **المكتبة القياسية أولاً**: استورد المكتبات القياسية قبل الحزم الخارجية
- **استيرادات محددة**: استخدم استيرادات محددة بدلاً من استيرادات البدل
- **نمط متسق**: جميع الملفات تتبع نفس بنية الاستيراد:

  ```python
  from docling.document_converter import DocumentConverter
  from docling.datamodel.pipeline_options import PdfPipelineOptions  # عند الحاجة
  import json  # استيرادات المكتبة القياسية بعد ذلك
  ```

#### معايير تنسيق الكود

- **المسافة البادئة المتسقة**: مسافة بادئة 4 مسافات في جميع الملفات
- **طول السطر**: حافظ على قابلية قراءة الأسطر، قم بكسر عناوين URL والسلاسل الطويلة بشكل مناسب
- **المسافات البيضاء**: مسافات متسقة حول العوامل وبعد الفواصل
- **علامات اقتباس السلاسل**: علامات اقتباس مفردة للسلاسل البسيطة، استخدام متسق داخل الملفات

### الأنماط الدلالية

#### سير عمل معالجة المستندات (100% من الملفات)

```python
def processing_function():
    converter = DocumentConverter()  # تهيئة المحول
    source = 'https://arxiv.org/pdf/...'  # تحديد المصدر
    
    try:
        result = converter.convert(source)  # معالجة المستند
        # معالجة النتائج والتصدير
    except Exception as e:
        print(f'خطأ: {e}')  # معالجة الأخطاء
```

#### نمط معالجة الأخطاء (100% من الملفات)

- **Try-Catch عالمي**: كل عملية تحويل ملفوفة في كتل try-except
- **رسائل خطأ وصفية**: استخدم تنسيق f-string لسياق الخطأ
- **التدهور التدريجي**: استمر في المعالجة أو قدم بدائل عند الإمكان
- **نوع الاستثناء**: استخدم `Exception` العام للقبض الواسع على الأخطاء

#### نمط إنشاء المخرجات (80% من الملفات)

```python
# التصدير إلى تنسيقات متعددة
markdown_output = result.document.export_to_markdown()
json_output = result.document.export_to_json()  # عند الحاجة

# الحفظ مع ترميز UTF-8
with open('filename.md', 'w', encoding='utf-8') as f:
    f.write(markdown_output)
```

#### نمط تقارير التقدم (100% من الملفات)

- **رؤوس الأقسام**: استخدم محددات `===` للأقسام الرئيسية
- **رسائل وصفية**: بيانات طباعة واضحة وغنية بالمعلومات
- **تحديثات الحالة**: الإبلاغ عن مراحل المعالجة والإكمال
- **تأكيد إنشاء الملف**: قم دائماً بتأكيد إنشاء الملفات

#### نمط قياس الأداء (40% من الملفات)

```python
import time
start_time = time.time()
# كود المعالجة
end_time = time.time()
processing_time = end_time - start_time
print(f'وقت المعالجة: {processing_time:.2f} ثانية')
```

### أنماط استخدام API الداخلي

#### تكوين DocumentConverter

```python
# الاستخدام الأساسي (60% من الملفات)
converter = DocumentConverter()

# مع خيارات خط الأنابيب (40% من الملفات)
pipeline_options = PdfPipelineOptions()
pipeline_options.do_ocr = True
converter = DocumentConverter(format_options={'pdf': pipeline_options})
```

#### نمط تحليل المستند (60% من الملفات)

```python
# مقاييس المستند القياسية
print(f'الصفحات: {len(result.document.pages)}')
print(f'العنوان: {result.document.title or "غير محدد"}')

# تحليل البنية التفصيلي
for page in result.document.pages:
    text_count += len(page.texts)
    table_count += len(page.tables)
    image_count += len(page.pictures)
```

#### نمط معالجة المصدر (100% من الملفات)

- **عناوين URL لـ arXiv**: مصدر الاختبار الأساسي لبنية مستند متسقة
- **تنسيق URL**: استخدم عناوين URL محددة لأوراق arXiv للاختبار القابل للتكرار
- **مصادر احتياطية**: قدم مصادر بديلة عند فشل المصدر الأساسي

### معايير التطوير

#### بنية الدالة

- **مسؤولية واحدة**: كل دالة لها غرض واحد واضح
- **حارس Main**: جميع الملفات تستخدم نمط `if __name__ == '__main__':`
- **بدون معاملات**: دوال الاختبار عادة لا تأخذ معاملات للبساطة

#### معايير إدخال/إخراج الملفات

- **ترميز UTF-8**: حدد الترميز بشكل صريح لجميع عمليات الملفات
- **مديرو السياق**: استخدم دائماً `with open()` لعمليات الملفات
- **أسماء ملفات وصفية**: ملفات المخرجات تطابق غرض الدالة

#### نهج الاختبار

- **التعقيد التدريجي**: ابدأ بأمثلة أساسية، تقدم إلى اختبارات شاملة
- **الوعي بالأجهزة**: فصل نهج اختبار CPU و GPU
- **دعم اللغة**: اختبار مخصص للمحتوى متعدد اللغات (العربية RTL)
- **سيناريوهات متعددة**: اختبر أنواع المستندات المختلفة وأوضاع المعالجة

### أنماط التوثيق

- **التعليقات المضمنة**: اشرح العمليات المعقدة وخيارات التكوين
- **أوصاف المخرجات**: صف بوضوح ما يمثله كل مخرج
- **سياق الخطأ**: قدم رسائل خطأ ذات معنى مع السياق
