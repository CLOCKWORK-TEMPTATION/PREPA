# مواصفات نظام الراوي الإصدار 4.0 - متطلبات النظام

## مقدمة

نظام "الراوي" هو نظام متقدم لمعالجة السيناريوهات العربية وتحويلها إلى مجموعات بيانات عالية الجودة لتدريب النماذج اللغوية الكبيرة. يهدف الإصدار 4.0 إلى تطوير النظام الحالي بإضافة أربع تحسينات هندسية متقدمة لتحسين جودة البيانات المستخرجة.

## المصطلحات والتعريفات

- **النظام**: نظام الراوي لمعالجة السيناريوهات الإصدار 4.0
- **المعالج**: وحدة ScreenplayParser المسؤولة عن تحليل النصوص
- **المثري**: وحدة AIEnricher المسؤولة عن إثراء البيانات
- **المصدر**: وحدة DatasetExporter المسؤولة عن تصدير البيانات
- **الكيان**: اسم الشخصية في السيناريو
- **الحوار**: DialogueTurn - وحدة حوار واحدة لشخصية معينة
- **المشهد**: Scene - مجموعة من الحوارات والأحداث في موقع وزمن محددين
- **التطبيع**: عملية توحيد أسماء الشخصيات المتشابهة
- **المسافة الليفنشتاين**: مقياس التشابه بين النصوص
- **السياق**: المعلومات الوصفية التي تسبق الحوار
- **الفلترة**: عملية إزالة الحوارات منخفضة الجودة
- **الميتاداتا الزمنية**: معلومات التوقيت والفترة الزمنية للمشهد

## المتطلبات

### المتطلب 1: توحيد الكيانات والتطبيع

**قصة المستخدم:** كمطور نماذج لغوية، أريد أن يتعامل النظام مع أسماء الشخصيات المتشابهة كشخصية واحدة، حتى أحصل على بيانات متسقة للتدريب.

#### معايير القبول

1. WHEN النظام يواجه أسماء شخصيات متشابهة THEN النظام SHALL حساب المسافة الليفنشتاين بينها
2. WHEN نسبة التشابه بين اسمين تزيد عن 85% THEN النظام SHALL ربط الاسم الأقصر بالاسم الأكثر تكراراً
3. WHEN يتم إنشاء قاموس التطبيع THEN النظام SHALL تطبيقه على جميع كائنات DialogueTurn قبل التصدير
4. WHEN يتم تطبيق التطبيع THEN النظام SHALL الاحتفاظ بسجل للأسماء المدمجة في ملف منفصل
5. WHEN يتم معالجة الأسماء THEN النظام SHALL استخدام مكتبة rapidfuzz أو difflib لحساب التشابه

### المتطلب 2: إثراء وصف المشهد

**قصة المستخدم:** كمدرب نماذج لغوية، أريد أن تتضمن بيانات التدريب السياق الوصفي للمشهد، حتى يفهم النموذج الظروف المحيطة بالحوار.

#### معايير القبول

1. WHEN يتم تصدير بيانات Alpaca THEN النظام SHALL تضمين آخر سطر وصفي مهم قبل الحوار
2. WHEN يتم إنشاء حقل الإدخال THEN النظام SHALL دمج معلومات المكان والزمان مع السياق الوصفي
3. WHEN يتم معالجة المشهد THEN النظام SHALL استخراج الأسطر الوصفية من قائمة actions
4. WHEN يتم تنسيق الإدخال THEN النظام SHALL استخدام التنسيق "المكان: X. [سياق: Y]. المتحدث: Z"
5. WHEN لا يوجد سياق وصفي THEN النظام SHALL استخدام عنوان المشهد فقط

### المتطلب 3: فلترة الجودة التلقائية

**قصة المستخدم:** كمطور مجموعات بيانات، أريد إزالة الحوارات منخفضة الجودة تلقائياً، حتى أحصل على بيانات تدريب عالية الجودة.

#### معايير القبول

1. WHEN عدد كلمات الحوار أقل من 3 كلمات THEN النظام SHALL حذف هذا الحوار
2. WHEN الحوار قصير لكن درجة المشاعر أعلى من 0.8 THEN النظام SHALL الاحتفاظ بالحوار
3. WHEN يتم تطبيق الفلترة THEN النظام SHALL تسجيل عدد الحوارات المحذوفة في ملف السجل
4. WHEN يتم حساب درجة المشاعر THEN النظام SHALL استخدام نموذج تحليل المشاعر الموجود
5. WHEN يتم تطبيق الفلترة THEN النظام SHALL تطبيقها في مرحلة التصدير قبل إنشاء الملفات

### المتطلب 4: استخراج الميتاداتا الزمنية

**قصة المستخدم:** كمحلل بيانات، أريد تمييز المشاهد حسب الفترة الزمنية (مثل الفلاش باك)، حتى أتمكن من تحليل التسلسل الزمني للأحداث.

#### معايير القبول

1. WHEN يتم تحليل عنوان المشهد THEN النظام SHALL البحث عن السنوات باستخدام النمط \b(19|20)\d{2}\b
2. WHEN يتم العثور على سنة في النص THEN النظام SHALL إضافة حقل time_period إلى كائن Scene
3. WHEN لا يتم العثور على سنة THEN النظام SHALL وراثة السنة من المشهد السابق أو وضع "غير محدد"
4. WHEN يتم تصدير البيانات THEN النظام SHALL تضمين time_period في ميتاداتا JSONL
5. WHEN يتم معالجة النصوص على الشاشة THEN النظام SHALL البحث عن المؤشرات الزمنية في محتوى المشهد

### المتطلب 5: التكامل مع البنية الموجودة

**قصة المستخدم:** كمطور نظام، أريد أن تتكامل التحسينات الجديدة بسلاسة مع الكود الموجود، حتى لا أحتاج لإعادة كتابة النظام بالكامل.

#### معايير القبول

1. WHEN يتم تطبيق التحسينات THEN النظام SHALL الحفاظ على البنية المعمارية الحالية (Ingestor -> Parser -> Enricher -> Exporter)
2. WHEN يتم إضافة مكتبات جديدة THEN النظام SHALL التعامل مع الاستيراد بطريقة آمنة مع معالجة الأخطاء
3. WHEN يتم تعديل الفئات الموجودة THEN النظام SHALL الحفاظ على التوافق مع الواجهات الحالية
4. WHEN يتم إضافة وظائف جديدة THEN النظام SHALL توثيقها بتعليقات عربية واضحة
5. WHEN يتم تشغيل النظام THEN النظام SHALL إنتاج نفس أنواع الملفات المخرجة مع البيانات المحسنة

### المتطلب 6: معالجة الأخطاء والسجلات

**قصة المستخدم:** كمشغل نظام، أريد رسائل سجل واضحة ومعالجة أخطاء قوية، حتى أتمكن من تشخيص المشاكل بسهولة.

#### معايير القبول

1. WHEN يحدث خطأ في أي مرحلة THEN النظام SHALL تسجيل رسالة خطأ واضحة باللغة العربية
2. WHEN يتم تطبيق التحسينات THEN النظام SHALL تسجيل إحصائيات العمليات المنجزة
3. WHEN تفشل مكتبة خارجية THEN النظام SHALL المتابعة بدون التحسين المعتمد عليها
4. WHEN يتم معالجة الملفات THEN النظام SHALL التحقق من وجود البيانات المطلوبة قبل المعالجة
5. WHEN يتم حفظ الملفات THEN النظام SHALL التأكد من نجاح عملية الكتابة قبل المتابعة