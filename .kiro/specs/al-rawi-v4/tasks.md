# خطة تنفيذ نظام الراوي الإصدار 4.0

- [ ] 1. إعداد البنية التحتية والمكتبات الجديدة
  - إضافة استيراد آمن لمكتبات rapidfuzz و hypothesis
  - تحديث معالجة الأخطاء للمكتبات الجديدة
  - إضافة تسجيل محسّن للعمليات الجديدة
  - _المتطلبات: 5.2, 6.1, 6.3_

- [ ] 1.1 كتابة اختبار خاصية للاستيراد الآمن للمكتبات
  - **الخاصية 18: معالجة فشل المكتبات**
  - **تتحقق من: المتطلبات 5.2, 6.3**

- [ ] 2. تطوير وحدة توحيد الكيانات (EntityCanonicalizer)
  - إنشاء فئة EntityCanonicalizer مع الواجهات المطلوبة
  - تنفيذ خوارزمية حساب التشابه باستخدام rapidfuzz/difflib
  - تنفيذ بناء قاموس التطبيع من المشاهد
  - تنفيذ تطبيق التطبيع على جميع الحوارات
  - _المتطلبات: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 2.1 كتابة اختبار خاصية لحساب التشابه
  - **الخاصية 1: حساب التشابه للأسماء المتشابهة**
  - **تتحقق من: المتطلبات 1.1, 1.5**

- [ ] 2.2 كتابة اختبار خاصية لربط الأسماء المتشابهة
  - **الخاصية 2: ربط الأسماء عالية التشابه**
  - **تتحقق من: المتطلبات 1.2**

- [ ] 2.3 كتابة اختبار خاصية للتطبيع الشامل
  - **الخاصية 3: تطبيق التطبيع الشامل**
  - **تتحقق من: المتطلبات 1.3**

- [ ] 2.4 كتابة اختبار خاصية لتوثيق عمليات الدمج
  - **الخاصية 4: توثيق عمليات الدمج**
  - **تتحقق من: المتطلبات 1.4**

- [ ] 2.5 دمج EntityCanonicalizer في طبقة AIEnricher
  - إضافة استدعاء EntityCanonicalizer في دالة enrich
  - تطبيق التطبيع على جميع المشاهد قبل التصدير
  - إضافة تسجيل إحصائيات التطبيع
  - _المتطلبات: 1.3, 6.2_

- [ ] 3. تطوير وحدة إثراء السياق
  - تعديل دالة export_contextual_alpaca لإضافة السياق الوصفي
  - تنفيذ استخراج آخر سطر وصفي مهم من actions
  - تنفيذ دمج معلومات المكان والزمان مع السياق
  - تنفيذ التنسيق المعياري للإدخال
  - _المتطلبات: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 3.1 كتابة اختبار خاصية لتضمين السياق الوصفي
  - **الخاصية 5: تضمين السياق الوصفي**
  - **تتحقق من: المتطلبات 2.1**

- [ ] 3.2 كتابة اختبار خاصية لدمج معلومات المشهد
  - **الخاصية 6: دمج معلومات المشهد**
  - **تتحقق من: المتطلبات 2.2**

- [ ] 3.3 كتابة اختبار خاصية لاستخراج الأسطر الوصفية
  - **الخاصية 7: استخراج الأسطر الوصفية**
  - **تتحقق من: المتطلبات 2.3**

- [ ] 3.4 كتابة اختبار خاصية لتنسيق الإدخال المعياري
  - **الخاصية 8: تنسيق الإدخال المعياري**
  - **تتحقق من: المتطلبات 2.4**

- [ ] 3.5 كتابة اختبارات وحدة للحالات الخاصة
  - اختبار السلوك عند عدم وجود سياق وصفي
  - اختبار استخراج الأسطر الوصفية من قوائم actions مختلفة
  - اختبار التنسيق مع معلومات مشهد متنوعة
  - _المتطلبات: 2.5_

- [ ] 4. تطوير وحدة فلترة الجودة (QualityFilter)
  - إنشاء فئة QualityFilter مع منطق الفلترة
  - تنفيذ فلترة الحوارات القصيرة (أقل من 3 كلمات)
  - تنفيذ استثناء الحوارات العاطفية (درجة مشاعر > 0.8)
  - تنفيذ تسجيل إحصائيات الفلترة
  - _المتطلبات: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 4.1 كتابة اختبار خاصية لفلترة الحوارات القصيرة
  - **الخاصية 9: فلترة الحوارات القصيرة**
  - **تتحقق من: المتطلبات 3.1, 3.2**

- [ ] 4.2 كتابة اختبار خاصية للاحتفاظ بالحوارات العاطفية
  - **الخاصية 10: الاحتفاظ بالحوارات العاطفية**
  - **تتحقق من: المتطلبات 3.2**

- [ ] 4.3 كتابة اختبار خاصية لتسجيل إحصائيات الفلترة
  - **الخاصية 11: تسجيل إحصائيات الفلترة**
  - **تتحقق من: المتطلبات 3.3**

- [ ] 4.4 كتابة اختبار خاصية لتطبيق الفلترة قبل التصدير
  - **الخاصية 12: تطبيق الفلترة قبل التصدير**
  - **تتحقق من: المتطلبات 3.5**

- [ ] 4.5 دمج QualityFilter في طبقة DatasetExporter
  - إضافة استدعاء QualityFilter في جميع دوال التصدير
  - تطبيق الفلترة قبل إنشاء الملفات
  - إضافة تسجيل عدد الحوارات المفلترة
  - _المتطلبات: 3.5, 6.2_

- [ ] 5. تطوير وحدة الميتاداتا الزمنية
  - تعديل نموذج Scene لإضافة حقل time_period
  - تعديل ScreenplayParser لاستخراج السنوات من العناوين
  - تنفيذ آلية وراثة الفترة الزمنية بين المشاهد
  - تعديل تصدير JSONL لتضمين time_period
  - _المتطلبات: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 5.1 كتابة اختبار خاصية لاستخراج السنوات من العناوين
  - **الخاصية 13: استخراج السنوات من العناوين**
  - **تتحقق من: المتطلبات 4.1**

- [ ] 5.2 كتابة اختبار خاصية لإضافة حقل الفترة الزمنية
  - **الخاصية 14: إضافة حقل الفترة الزمنية**
  - **تتحقق من: المتطلبات 4.2**

- [ ] 5.3 كتابة اختبار خاصية لوراثة الفترة الزمنية
  - **الخاصية 15: وراثة الفترة الزمنية**
  - **تتحقق من: المتطلبات 4.3**

- [ ] 5.4 كتابة اختبار خاصية لتضمين الفترة في التصدير
  - **الخاصية 16: تضمين الفترة في التصدير**
  - **تتحقق من: المتطلبات 4.4**

- [ ] 5.5 كتابة اختبار خاصية للبحث في محتوى المشهد
  - **الخاصية 17: البحث في محتوى المشهد**
  - **تتحقق من: المتطلبات 4.5**

- [ ] 5.6 كتابة اختبارات وحدة للحالات الزمنية المحددة
  - اختبار استخراج سنوات محددة (1986, 2009)
  - اختبار السلوك عند عدم وجود سنوات
  - اختبار وراثة السنوات عبر مشاهد متتالية
  - _المتطلبات: 4.1, 4.2, 4.3_

- [ ] 6. نقطة تفتيش - التأكد من نجاح جميع الاختبارات
  - التأكد من نجاح جميع الاختبارات، اسأل المستخدم إذا ظهرت أسئلة.

- [ ] 7. تحسين معالجة الأخطاء والتسجيل
  - إضافة معالجة شاملة للأخطاء في جميع الوحدات الجديدة
  - تحسين رسائل السجل لتكون أكثر وضوحاً باللغة العربية
  - إضافة التحقق من صحة البيانات قبل المعالجة
  - إضافة ضمان نجاح عمليات الكتابة
  - _المتطلبات: 6.1, 6.2, 6.4, 6.5_

- [ ] 7.1 كتابة اختبار خاصية لتسجيل الأخطاء
  - **الخاصية 20: تسجيل الأخطاء**
  - **تتحقق من: المتطلبات 6.1**

- [ ] 7.2 كتابة اختبار خاصية لتسجيل الإحصائيات
  - **الخاصية 21: تسجيل الإحصائيات**
  - **تتحقق من: المتطلبات 6.2**

- [ ] 7.3 كتابة اختبار خاصية للتحقق من البيانات
  - **الخاصية 22: التحقق من البيانات**
  - **تتحقق من: المتطلبات 6.4**

- [ ] 7.4 كتابة اختبار خاصية لضمان نجاح الكتابة
  - **الخاصية 23: ضمان نجاح الكتابة**
  - **تتحقق من: المتطلبات 6.5**

- [ ] 8. تحديث الدالة الرئيسية main()
  - دمج جميع التحسينات في تدفق العمل الرئيسي
  - إضافة تسجيل إحصائيات شاملة للتحسينات
  - التأكد من إنتاج نفس أنواع الملفات مع البيانات المحسنة
  - إضافة معالجة أخطاء شاملة للعملية الكاملة
  - _المتطلبات: 5.5, 6.1, 6.2_

- [ ] 8.1 كتابة اختبار خاصية لإنتاج الملفات المتوقعة
  - **الخاصية 19: إنتاج الملفات المتوقعة**
  - **تتحقق من: المتطلبات 5.5**

- [ ] 9. اختبار التكامل الشامل
  - اختبار النظام الكامل مع ملفات سيناريو حقيقية
  - التحقق من جودة البيانات المُصدرة
  - قياس تحسن جودة البيانات مقارنة بالإصدار السابق
  - اختبار الأداء مع ملفات كبيرة
  - _المتطلبات: جميع المتطلبات_

- [ ] 9.1 كتابة اختبارات تكامل للسيناريوهات الكاملة
  - اختبار معالجة ملف سيناريو كامل من البداية للنهاية
  - التحقق من تطبيق جميع التحسينات بشكل صحيح
  - قياس الإحصائيات النهائية للتحسينات
  - _المتطلبات: جميع المتطلبات_

- [x] 10. توثيق التحسينات وإرشادات الاستخدام ✅
  - ✅ تحديث التوثيق ليشمل التحسينات الجديدة
  - ✅ إضافة أمثلة على الاستخدام للميزات الجديدة
  - ✅ توثيق معايير جودة البيانات المحسنة
  - ✅ إنشاء دليل استكشاف الأخطاء وإصلاحها
  - _المتطلبات: 5.4_
  - **تم الإنجاز:** تم إنشاء ملف `docs/FEATURES_GUIDE.md` الشامل

- [ ] 11. نقطة تفتيش نهائية - التأكد من نجاح جميع الاختبارات
  - التأكد من نجاح جميع الاختبارات، اسأل المستخدم إذا ظهرت أسئلة.